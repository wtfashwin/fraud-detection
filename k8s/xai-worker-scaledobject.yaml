apiVersion: keda.sh/v1alpha1
kind: ScaledObject
metadata:
  name: xai-worker-scaler
  namespace: default
spec:
  scaleTargetRef:
    name: xai-worker  # Reference to the Deployment
  minReplicaCount: 0  # Scale to zero when no tasks
  maxReplicaCount: 10
  pollingInterval: 15  # Check every 15 seconds
  cooldownPeriod: 30  # Wait 30 seconds before scaling down
  triggers:
  - type: redis
    metadata:
      # Redis list key that Celery uses (celery is the default queue name)
      address: redis://redis:6379
      listName: celery  # Default Celery queue name
      listLength: "5"  # Target value - scale up if more than 5 tasks queued
      enableTLS: "false"
      # Optional authentication
      #password: <redis-password>
      #username: <redis-username>